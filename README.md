# LangGraph ReAct Agent Template

[![CI](https://github.com/langchain-ai/react-agent/actions/workflows/unit-tests.yml/badge.svg)](https://github.com/langchain-ai/react-agent/actions/workflows/unit-tests.yml)
[![Integration Tests](https://github.com/langchain-ai/react-agent/actions/workflows/integration-tests.yml/badge.svg)](https://github.com/langchain-ai/react-agent/actions/workflows/integration-tests.yml)
[![Open in - LangGraph Studio](https://img.shields.io/badge/Open_in-LangGraph_Studio-00324d.svg?logo=data:image/svg%2bxml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4NS4zMzMiIGhlaWdodD0iODUuMzMzIiB2ZXJzaW9uPSIxLjAiIHZpZXdCb3g9IjAgMCA2NCA2NCI+PHBhdGggZD0iTTEzIDcuOGMtNi4zIDMuMS03LjEgNi4zLTYuOCAyNS43LjQgMjQuNi4zIDI0LjUgMjUuOSAyNC41QzU3LjUgNTggNTggNTcuNSA1OCAzMi4zIDU4IDcuMyA1Ni43IDYgMzIgNmMtMTIuOCAwLTE2LjEuMy0xOSAxLjhtMzcuNiAxNi42YzIuOCAyLjggMy40IDQuMiAzLjQgNy42cy0uNiA0LjgtMy40IDcuNkw0Ny4yIDQzSDE2LjhsLTMuNC0zLjRjLTQuOC00LjgtNC44LTEwLjQgMC0xNS4ybDMuNC0zLjRoMzAuNHoiLz48cGF0aCBkPSJNMTguOSAyNS42Yy0xLjEgMS4zLTEgMS43LjQgMi41LjkuNiAxLjcgMS44IDEuNyAyLjcgMCAxIC43IDIuOCAxLjYgNC4xIDEuNCAxLjkgMS40IDIuNS4zIDMuMi0xIC42LS42LjkgMS40LjkgMS41IDAgMi43LS41IDIuNy0xIDAtLjYgMS4xLS44IDIuNi0uNGwyLjYuNy0xLjgtMi45Yy01LjktOS4zLTkuNC0xMi4zLTExLjUtOS44TTM5IDI2YzAgMS4xLS45IDIuNS0yIDMuMi0yLjQgMS41LTIuNiAzLjQtLjUgNC4yLjguMyAyIDEuNyAyLjUgMy4xLjYgMS41IDEuNCAyLjMgMiAyIDEuNS0uOSAxLjItMy41LS40LTMuNS0yLjEgMC0yLjgtMi44LS44LTMuMyAxLjYtLjQgMS42LS41IDAtLjYtMS4xLS4xLTEuNS0uNi0xLjItMS42LjctMS43IDMuMy0yLjEgMy41LS41LjEuNS4yIDEuNi4zIDIuMiAwIC43LjkgMS40IDEuOSAxLjYgMi4xLjQgMi4zLTIuMy4yLTMuMi0uOC0uMy0yLTEuNy0yLjUtMy4xLTEuMS0zLTMtMy4zLTMtLjUiLz48L3N2Zz4=)](https://langgraph-studio.vercel.app/templates/open?githubUrl=https://github.com/langchain-ai/react-agent)

This template showcases a [ReAct agent](https://arxiv.org/abs/2210.03629) implemented using [LangGraph](https://github.com/langchain-ai/langgraph), designed for [LangGraph Studio](https://github.com/langchain-ai/langgraph-studio). ReAct agents are uncomplicated, prototypical agents that can be flexibly extended to many tools.

![Graph view in LangGraph studio UI](./static/studio_ui.png)

The core logic, defined in `src/react_agent/graph.py`, demonstrates a flexible ReAct agent that iteratively reasons about user queries and executes actions, showcasing the power of this approach for complex problem-solving tasks.

## What it does

The ReAct agent:

1. Takes a user **query** as input
2. Reasons about the query and decides on an action
3. Executes the chosen action using available tools
4. Observes the result of the action
5. Repeats steps 2-4 until it can provide a final answer

By default, it's set up with a basic set of tools, but can be easily extended with custom tools to suit various use cases.

### Odoo 18 Code Search/Load Utility with Enhanced Critic

This project includes a powerful Odoo 18 Code Search/Load Utility, available to both Main and Critic agents:

- **Search and load Odoo 18 standard code** from GitHub (official Odoo repository) with fallback to Hugging Face datasets if GitHub is unavailable.
- **Validate generated code** against Odoo 18 best practices and deprecations, providing actionable feedback and warnings.
- **Generate minimal working code snippets** from Odoo 18 core modules.
- **Integrate validation results** into the Critic agent's feedback and scoring, ensuring code quality and adherence to Odoo standards.
- **Async/await support** for efficient tool usage in agent workflows.
- **Tool-enabled Critic agent** that can actively search Odoo codebase and web resources during evaluation.
- **Better organized prompt templates** moved to a dedicated prompts.py file for improved maintainability.
- **Compatible with all LLM providers** including models that don't support tool binding (like Ollama models).

This utility enhances the agent's ability to generate, validate, and improve Odoo 18 code, making the workflow more robust for Odoo development tasks.

## Getting Started

Assuming you have already [installed LangGraph Studio](https://github.com/langchain-ai/langgraph-studio?tab=readme-ov-file#download), to set up:

1. Create a `.env` file.

```bash
cp .env.example .env
```

2. Define required API keys in your `.env` file.

The primary [search tool](./src/react_agent/tools.py) [^1] used is [Tavily](https://tavily.com/). Create an API key [here](https://app.tavily.com/sign-in).

<!--
Setup instruction auto-generated by `langgraph template lock`. DO NOT EDIT MANUALLY.
-->

### Setup Model

The defaults values for `model` are shown below:

```yaml
model: anthropic/claude-3-5-sonnet-20240620
```

Follow the instructions below to get set up, or pick one of the additional options.

#### Anthropic

To use Anthropic's chat models:

1. Sign up for an [Anthropic API key](https://console.anthropic.com/) if you haven't already.
2. Once you have your API key, add it to your `.env` file:

```
ANTHROPIC_API_KEY=your-api-key
```
#### OpenAI

To use OpenAI's chat models:

1. Sign up for an [OpenAI API key](https://platform.openai.com/signup).
2. Once you have your API key, add it to your `.env` file:
```
OPENAI_API_KEY=your-api-key
```

<!--
End setup instructions
-->

3. Customize whatever you'd like in the code.
4. Open the folder LangGraph Studio!

## How to customize

1. **Add new tools**: Extend the agent's capabilities by adding new tools in [tools.py](./src/react_agent/tools.py). These can be any Python functions that perform specific tasks. The Odoo 18 Code Search/Load Utility is available as `ODOO_CODE_TOOLS` in [odoo_code_utils.py](./src/react_agent/odoo_code_utils.py) and is integrated into the agent workflow.
2. **Select a different model**: We default to Anthropic's Claude 3 Sonnet. You can select a compatible chat model using `provider/model-name` via configuration. Example: `openai/gpt-4-turbo-preview`.
3. **Customize the prompt**: We provide a default system prompt in [prompts.py](./src/react_agent/prompts.py). You can easily update this via configuration in the studio.

You can also quickly extend this template by:

- Modifying the agent's reasoning process in [graph.py](./src/react_agent/graph.py).
- Adjusting the ReAct loop or adding additional steps to the agent's decision-making process.

## Development

While iterating on your graph, you can edit past state and rerun your app from past states to debug specific nodes. Local changes will be automatically applied via hot reload. Try adding an interrupt before the agent calls tools, updating the default system message in `src/react_agent/configuration.py` to take on a persona, or adding additional nodes and edges!

Follow up requests will be appended to the same thread. You can create an entirely new thread, clearing previous history, using the `+` button in the top right.

You can find the latest (under construction) docs on [LangGraph](https://github.com/langchain-ai/langgraph) here, including examples and other references. Using those guides can help you pick the right patterns to adapt here for your use case.

LangGraph Studio also integrates with [LangSmith](https://smith.langchain.com/) for more in-depth tracing and collaboration with teammates.

[^1]: https://python.langchain.com/docs/concepts/#tools

<!--
Configuration auto-generated by `langgraph template lock`. DO NOT EDIT MANUALLY.
{
  "config_schemas": {
    "agent": {
      "type": "object",
      "properties": {
        "model": {
          "type": "string",
          "default": "anthropic/claude-3-5-sonnet-20240620",
          "description": "The name of the language model to use for the agent's main interactions. Should be in the form: provider/model-name.",
          "environment": [
            {
              "value": "anthropic/claude-1.2",
              "variables": "ANTHROPIC_API_KEY"
            },
            {
              "value": "anthropic/claude-2.0",
              "variables": "ANTHROPIC_API_KEY"
            },
            {
              "value": "anthropic/claude-2.1",
              "variables": "ANTHROPIC_API_KEY"
            },
            {
              "value": "anthropic/claude-3-5-sonnet-20240620",
              "variables": "ANTHROPIC_API_KEY"
            },
            {
              "value": "anthropic/claude-3-haiku-20240307",
              "variables": "ANTHROPIC_API_KEY"
            },
            {
              "value": "anthropic/claude-3-opus-20240229",
              "variables": "ANTHROPIC_API_KEY"
            },
            {
              "value": "anthropic/claude-3-sonnet-20240229",
              "variables": "ANTHROPIC_API_KEY"
            },
            {
              "value": "anthropic/claude-instant-1.2",
              "variables": "ANTHROPIC_API_KEY"
            },
            {
              "value": "openai/gpt-3.5-turbo",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-3.5-turbo-0125",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-3.5-turbo-0301",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-3.5-turbo-0613",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-3.5-turbo-1106",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-3.5-turbo-16k",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-3.5-turbo-16k-0613",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-4",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-4-0125-preview",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-4-0314",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-4-0613",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-4-1106-preview",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-4-32k",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-4-32k-0314",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-4-32k-0613",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-4-turbo",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-4-turbo-preview",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-4-vision-preview",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-4o",
              "variables": "OPENAI_API_KEY"
            },
            {
              "value": "openai/gpt-4o-mini",
              "variables": "OPENAI_API_KEY"
            }
          ]
        }
      },
      "environment": [
        "TAVILY_API_KEY"
      ]
    }
  }
}
-->

## Recent Changes

### Supabase Vector Database Integration (Added: 2025-05-22)

The project now includes integration with Supabase vector database for enhanced Odoo code search capabilities:

- **Vector Search**: Semantic search using embeddings stored in Supabase PostgreSQL with pgvector extension
- **Metadata Filtering**: Filter search results by module, file type, and Odoo version
- **Fallback Mechanism**: Gracefully falls back to GitHub API and Hugging Face dataset when vector search is unavailable

#### Setup Instructions

1. **Create a Supabase Project**:
   - Sign up at [Supabase](https://supabase.com/) and create a new project
   - Enable the pgvector extension in your Supabase project

2. **Create the Vector Table**:
   - Run the following SQL in the Supabase SQL Editor:
   ```sql
   -- Enable the pgvector extension
   create extension if not exists vector;

   -- Create a table for storing Odoo code embeddings
   create table odoo_embeddings (
     id bigint generated always as identity primary key,
     content text not null,
     embedding vector(1536) not null,
     metadata jsonb not null,
     created_at timestamp with time zone default now()
   );

   -- Create a function to match embeddings
   create or replace function match_embeddings(
     query_embedding vector(1536),
     match_threshold float,
     match_count int
   )
   returns table (
     id bigint,
     content text,
     metadata jsonb,
     similarity float
   )
   language plpgsql
   as $
   begin
     return query
     select
       odoo_embeddings.id,
       odoo_embeddings.content,
       odoo_embeddings.metadata,
       1 - (odoo_embeddings.embedding <=> query_embedding) as similarity
     from odoo_embeddings
     where 1 - (odoo_embeddings.embedding <=> query_embedding) > match_threshold
     order by odoo_embeddings.embedding <=> query_embedding
     limit match_count;
   end;
   $;
   ```

3. **Configure Environment Variables**:
   - Add your Supabase URL and API key to the `.env` file:
   ```
   SUPABASE_URL=your-supabase-url-here
   SUPABASE_KEY=your-supabase-key-here
   ODOO_LOCAL_REPO_PATH=/path/to/odoo/repository
   ```

4. **Populate the Vector Database**:
   - Run the provided script to index your Odoo codebase:
   ```bash
   # Index all supported file types (Python, XML, JavaScript, CSS, etc.)
   python scripts/populate_vector_db.py --odoo-path /path/to/odoo/repository --odoo-version 18.0
   
   # Limit the number of files for testing
   python scripts/populate_vector_db.py --odoo-path /path/to/odoo/repository --odoo-version 18.0 --limit 50
   
   # Index only specific file types
   python scripts/populate_vector_db.py --odoo-path /path/to/odoo/repository --odoo-version 18.0 --file-types py xml js
   ```
   
   The script supports the following file types:
   - Python (`.py`): Models, controllers, wizards, tests, etc.
   - XML (`.xml`): Views, data, security, reports, etc.
   - JavaScript (`.js`, `.mjs`): Client-side code, components, etc.
   - CSS/SCSS (`.css`, `.scss`, `.sass`, `.less`): Styling
   - Documentation (`.md`, `.rst`, `.txt`): Readme files, docs
   - Other formats: CSV, SQL, QWeb templates

### Prompt Formatting Fix

- Fixed a KeyError in `src/react_agent/graph.py` by removing an unnecessary `name` argument from the `ODOO_18_SYSTEM_PROMPT` formatting call. The prompt now only uses the `system_time` variable, matching the template in `prompts.py`.
- This resolves runtime errors when running the OdooReactAgent and ensures prompt formatting is consistent with the defined template.

### Ollama Model Compatibility Fix

- Fixed NotImplementedError when calling `bind_tools()` on Ollama models (qwen2.5-coder:7b and llama3:8b).
- Implemented try/except blocks around all `bind_tools()` calls to gracefully handle models that don't support LangChain's direct tool binding interface.
- Added fallback to using the base model without tool binding when the NotImplementedError is raised.
- Applied the fix to all instances in the `call_model` function:
  - Initial model loading
  - Timeout fallback scenario
  - Rate limit fallback scenario
- Note: When using Ollama models without tool binding, tools won't be available through the structured tool interface. Full tool functionality requires models with native tool binding support like OpenAI, Anthropic, or certain Gemini models.

### Development Workflow with LangGraph Studio

- Leveraged LangGraph Studio's hot-reload capability for faster development.
- The development server automatically detects changes to Python files and reloads itself.
- This eliminates the need to manually restart the server after code changes.
- Benefits include:
  - Faster iteration cycles when fixing issues
  - Immediate application of changes to fix runtime errors
  - Streamlined debugging workflow
- Note: For complex changes or package dependencies, a manual restart might still be needed, but for most code fixes, the hot-reload feature works well.

## Custom Chatbot Implementation

The project now includes a custom chatbot implemented in `src/react_agent/app.py`. This chatbot interacts with the Odoo 18 React Agent, providing a seamless integration between the chat interface and the agent's capabilities.

Key Features:
- Direct interaction with Odoo 18 React Agent
- Customizable chat interface
- Integration with existing agent tools

## Test Suite Consolidation

The test suite has been reorganized and consolidated for better maintainability and coverage (Updated: 2025-05-24):

- **Consolidated Test Structure**: Reduced the number of test files by organizing tests into logical categories:
  - `test_components.py`: Tests for core components including the critic agent and workflow
  - `test_integration.py`: End-to-end tests for agent workflow and error handling
  - `test_models.py`: Tests for model handling including Ollama compatibility
  - `test_vector_store.py`: Tests for vector storage and retrieval functionality

- **Improved Mocking**: Enhanced test mocks to properly simulate asynchronous operations and external API calls

- **Error Handling Coverage**: Added specific tests for NotImplementedError handling with Ollama models

- **Maintainability**: Removed duplicate test coverage while preserving Odoo-specific tests for domain-specific functionality